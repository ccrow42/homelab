version: v1
kind: kubernetes
application: utilities

targets:
  pre-stage-lab:
    account: stage-lab
    namespace: metallb-system
    strategy: rolling
  pre-prod-lab:
    account: prod-lab
    namespace: metallb-system
    strategy: rolling
    constraints:
      dependsOn:
      - pre-stage-lab
  stage-lab:
    account: stage-lab
    namespace: metallb-system
    strategy: rolling
    constraints:
      dependsOn:
      - pre-stage-lab
  prod-lab:
    account: prod-lab
    namespace: metallb-system
    strategy: rolling
    constraints:
      dependsOn:
      - stage-lab
      - pre-prod-lab

manifests:
  - path: /manifests/metallb/metallb-native.yaml
    targets: ['pre-prod-lab','pre-stage-lab']
  - path: /manifests/metallb/metallb-prod.yaml
    targets: ['prod-lab']
  - path: /manifests/metallb/metallb-stage.yaml
    targets: ['stage-lab']

  
strategies:
  rolling:
    canary:
      steps:
        - setWeight:
            weight: 100
