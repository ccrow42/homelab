version: v1
kind: kubernetes
application: utilities

targets:
  pre-stage-lab:
    account: stage-lab
    namespace: portworx
    strategy: rolling
  pre-prod-lab:
    account: prod-lab
    namespace: portworx
    strategy: rolling
    constraints:
      dependsOn:
      - secret-stage-lab


manifests:
  - path: /manifests/portworx/px-vsphere-secret.yaml
    targets: ['secret-prod-lab','secret-stage-lab']
  - path: /manifests/portworx/px-operator.yaml
    targets: ['pre-prod-lab','pre-stage-lab']

  
strategies:
  rolling:
    canary:
      steps:
        - setWeight:
            weight: 100
