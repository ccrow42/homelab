version: v1
kind: kubernetes
application: utilities

targets:
  ns-stage-lab:
    account: stage-lab
    namespace: portworx
    strategy: rolling
  ns-prod-lab:
    account: prod-lab
    namespace: portworx
    strategy: rolling
    constraints:
      dependsOn:
      - ns-stage-lab
  secret-stage-lab:
    account: stage-lab
    namespace: portworx
    strategy: rolling
    constraints:
      dependsOn:
      - ns-prod-lab
  secret-prod-lab:
    account: prod-lab
    namespace: portworx
    strategy: rolling
    constraints:
      dependsOn:
      - secret-stage-lab


manifests:
  - path: /manifests/portworx/namespace.yaml
    targets: ['ns-prod-lab','ns-stage-lab']
  - path: /manifests/portworx/px-vsphere-secret.yaml
    targets: ['secret-prod-lab','secret-stage-lab']

  
strategies:
  rolling:
    canary:
      steps:
        - setWeight:
            weight: 100
